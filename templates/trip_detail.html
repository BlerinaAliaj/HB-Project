{% extends 'base.html' %}

{% block title %} 
<meta name="viewport" content="initial-scale=1.0">
<meta charset="utf-8">
<style type="text/css">


</style>
{% endblock %}

{% block content %}
<div class="col-xs-12">
    <h1>Hello {{ name }}:</h1>
    <h1>Welcome to {{ trip_name }} trip page. </h1>
    
    <h2>People that are joining you on this trip:</h2>

    <ul>
        {% for member in members %}
            {% if member.user_id != username %}

            <li>
              <a href="/member_profile/{{ username }}">
                {{ member.first_name }} {{ member.last_name }}</a> 
            </li>

          {% endif %}
      {% endfor %}

    </ul>
    <a href="/add_member/{{ trip_code }}">Add members to this trip</a>
</div>

<div id="chatlogs" >
    <h1>Group Communication:</h1>
  
   <ul id="messages" style="height: 100px; overflow-y: auto">
    {% for msg in messages %}
      <li>{{ msg.comment }}</li>

    {% endfor %}
   </ul>
<div id="chat-end"></div>

</div>


<div>
  <form id="sendmessage">
    <textarea rows="4" cols="80" id="mytext" name="mymessage"></textarea>
    <input id="sendbutton" type="button" value="Send Message" >
  </form>
</div>



<div class="list">
  <h1> Your List here</h1>
  <form class="updateList" action="/list/{{ trip_code }}" method="POST">
    <table class="editabletable" border="1">
      <tbody>
        <tr id='header'>
          <td> Action Items </td>
          <td>Action Assigned To</td>
          <td>Completed (Y/N)</td>
        </tr>
        {% if items %}
        {% for item in items %}
        <tr id="{{ item.item_id }}">
          <td><div id='desc' contenteditable>{{ item.description }}</div></td>
          <td><div id='usid' contenteditable>{{ item.user_id }}</div></td>
          <td><div id='comp' contenteditable>{{ item.completed }}</div></td>
          <!-- <td><input id='comp' type="checkbox" name="comp" value="{{ item.completed }}">{{ item.completed }}</td> -->
        </tr>
        {% endfor %}
        {% endif %}
        <tr id="addItem">
          <td><input id="indesc" type="text" name="description"></td>
          <td><input id="inusid" type="text" name="userid"></td>
          <td><input id="incomp" type="checkbox" name="completed"></td>
        </tr>
      </tbody>
      <input id="listitem" type='submit' value='Update List' >


    </table>
  </form>
</div>


<div>
<h1> Your Maps go here:</h1>
    <div id="floating-panel">
      <input id="address" type="textbox" value="San Francisco, CA">
      <input id="submit" type="button" value="Geocode">
      <input id="submarker" type="button" value="Log This Route">
    </div>
    <div id="map" style="width: 900px; height: 400px; "></div>
</div>

<div>
  <h1> This is the End</h1>
  <h2> Yes it is</h2>
</div>

<!-- Place your scripts here:  -->


<script src="https://code.jquery.com/jquery.js"></script>
<script type="text/javascript"> 
var tripCode = "{{ trip_code }}";



function submitList(evt) {
  
  evt.preventDefault();
  var allList = {};
  var allData = {};
  var rowId;
  var desc; 
  var usid;
  var comp;

  allList["tripCode"] = tripCode;

  $(".editabletable tr").each(function(){

      rowId = $(this).attr('id');
      // console.log(rowId);

      if (rowId === "addItem") {
        $('#'+rowId).each(function() {
        desc = $(this).find('#indesc').val();
        usid = $(this).find('#inusid').val();
        comp = $(this).find('#incomp').is(":checked");

        // console.log(comp);

        allData[rowId] = {"description": desc,
                        "userid": usid,
                        "completed": comp} 
      });
      } else {

        $('#'+rowId).each(function() {
        desc = $(this).find('#desc').text();
        usid = $(this).find('#usid').text();
        comp = $(this).find('#comp').text(); 
        console.log(comp);

        allData[rowId] = {"description": desc,
                        "userid": usid,
                        "completed": comp} 
      });
    }
  });

  allList['allData'] = JSON.stringify(allData);
  console.log(allList);

  $.post("/list.json", allList, function(){ alert("it worked"); });
}


// function addRow() {

// }

$(".updateList").on('submit', submitList);
// $(".updateList").on('return', addRow)

</script>
<script src="https://code.jquery.com/jquery.js"></script>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
<script type="text/javascript" src="/static/myscript.js"></script>
<script type="text/javascript" src="/static/chat.js"></script>

<script src="https://maps.googleapis.com/maps/api/js?key=&callback=initMap"
async defer></script>

{% endblock %}